<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.css" />
</head>
<body style="margin-top: 50px; margin-left: 20px">
<div class="columns">
    <div class="column is-one-quarter">
        <input id="player1" class="input is-medium" type="text" placeholder="Joueur 1">
    </div>
    <div class="column is-narrow">
        <p style="font-weight: bold; font-size: x-large">VS</p>
    </div>
    <div class="column is-one-quarter">
        <input id="player2" class="input is-medium" type="text" placeholder="Joueur 2">
    </div>
    <div class="column is-one-fifth">
        <button id="add_game" onclick="addNewGame()" class="button is-medium is-info" type="button" style="padding: 20px 50px">Ajouter</button>
    </div>
    <div class="column"></div>
</div>
<div class="columns">
    <div class="column is-half">
        <fieldset style="text-overflow: clip; border-radius: 5px">
            <legend class="is-title column box is-narrow" style="border: 1px #209cee solid; background-color: #209cee; color: white">Les parties</legend>
            <div id="nbActiveGames" class="box column is-narrow" style="float: right; margin-top: -70px; border: 1px #209cee solid; background-color: #209cee; color: white">0</div>
            <table id="games_list" style="margin-left: 30px"></table>
        </fieldset>
    </div>
</div>
<script src="/socket.io/socket.io.js"></script>
<script>
  let activeGames = 0
  let socket = io()
    function addNewGame() {
      let player1 = document.getElementById('player1').value
      let player2 = document.getElementById('player2').value
      socket.emit('newGame', {player1: player1, player2: player2})
        //socket.emit('addGame', '')
    }
    function deleteGame(id) {
      socket.emit('deleteGame', id)
    }
    function toggleGame(id) {
      socket.emit('toggleGame', id)
      let checkboxToToggle = document.getElementById(`checkbox${id}`)
      if (checkboxToToggle.checked)
        activeGames += 1
      else
        activeGames -= 1
      updateNumberOfActiveGames()
    }
    function updateNumberOfActiveGames() {
      document.getElementById('nbActiveGames').innerText = activeGames
    }
  socket.on('news', function (data) {
    console.log(data);
  });
  socket.on('newGame', (data) => {
    let checkedState = data.state ? 'checked="checked"' : ''
    let elementToAdd = `<tr id=${data.id}>
                            <td>
                                <label class="checkbox">
                                    <input id="checkbox${data.id}" ${checkedState} type="checkbox" onclick="toggleGame(${data.id})">
                                    ${data.player1} vs ${data.player2}
                                </label>
                            </td>
                            <td>
                                <button style="background-color: red; margin-left: 50px; margin-bottom: 10px" class="delete is-large" onclick="deleteGame(${data.id})">Supprimer</button>
                            </td>
                        </tr>`
    document.getElementById('games_list').innerHTML += elementToAdd
    activeGames += 1
    updateNumberOfActiveGames()
    console.log(data)
  });
  socket.on('deleteGame', (data) => {
    console.log(data)
    let nodeToDelete = document.getElementById(data)
    let checkBox = document.getElementById(`checkbox${data}`)
    if (checkBox.checked)
    {
      activeGames -= 1
      updateNumberOfActiveGames()
    }
    while (nodeToDelete.firstChild) {
      nodeToDelete.removeChild(nodeToDelete.firstChild)
    }
  });
  socket.on('toggleGame', (data) => {
    let checkboxToToggle = document.getElementById(`checkbox${data}`)
    checkboxToToggle.checked = !checkboxToToggle.checked
    if (checkboxToToggle.checked)
      activeGames += 1
    else
      activeGames -= 1
    updateNumberOfActiveGames()
    console.log("updating")
  });
</script>
</body>
</html>